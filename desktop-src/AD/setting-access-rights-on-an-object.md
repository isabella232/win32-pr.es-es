---
title: Establecer derechos de acceso en un objeto
description: En este tema se describe cómo crear una ACE para un derecho de acceso y establecer esa ACE en la DACL de un objeto .
ms.assetid: c0b45709-4652-46c7-8d52-44076802d109
ms.tgt_platform: multiple
keywords:
- Establecimiento de derechos de acceso en un objeto AD
- Objects AD , Establecer derechos de acceso en un objeto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 36ca2c26e3e242656a1ae0471fe9ccd22fa132a8
ms.sourcegitcommit: 61a4c522182aa1cacbf5669683d9570a3bf043b2
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/26/2021
ms.locfileid: "122881206"
---
# <a name="setting-access-rights-on-an-object"></a>Establecer derechos de acceso en un objeto

Al usar los objetos COM ADSI [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) (descriptor de seguridad), [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) (DACL y SACL) e [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) (ACE) para agregar una ACE a una ACL, está realizando cambios en la propiedad **nTSecurityDescriptor** del objeto especificado en la caché de propiedades. Esto significa que se debe llamar a los métodos put en los objetos que contienen la nueva ACE y el método [**IADs.SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) para escribir el descriptor de seguridad actualizado en el directorio desde la caché de propiedades.

Para obtener más información y un ejemplo de código que establece una ACE en un objeto de Active Directory Domain Services, vea Ejemplo de código para establecer una [ACE en un objeto de directorio](example-code-for-setting-an-ace-on-a-directory-object.md).

Use el siguiente proceso general para crear una ACE para un derecho de acceso y establecer esa ACE en la DACL de un objeto.

1.  Obtiene un [**puntero de interfaz**](/windows/desktop/api/iads/nn-iads-iads) de los IAD al objeto .
2.  Use el [**método IADs.Get**](/windows/desktop/api/iads/nf-iads-iads-get) para obtener el descriptor de seguridad del objeto . El nombre de la propiedad que contiene el descriptor de seguridad **es nTSecurityDescriptor**. La propiedad se devolverá como [**variant que**](/windows/win32/api/oaidl/ns-oaidl-variant) contiene un puntero [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) (el **miembro vt** es **VT \_ DISPATCH**). Llame **a QueryInterface** en ese puntero **IDispatch** para obtener una interfaz [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) para usar los métodos de esa interfaz para acceder a la ACL del descriptor de seguridad.
3.  Use la [**propiedad IADsSecurityDescriptor.DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para obtener la DACL. El método devuelve un [**puntero IDispatch.**](/windows/win32/api/oaidl/nn-oaidl-idispatch) Llame **a QueryInterface** en ese puntero **IDispatch** para obtener una interfaz [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) para usar los métodos de esa interfaz para acceder a las ACE individuales de la ACL.
4.  Use [**CoCreateInstance para**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) crear el objeto COM ADSI para la nueva ACE y obtener un puntero de interfaz [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) a ese objeto. Tenga en cuenta que el identificador de clase es CLSID \_ AccessControlEntry.
5.  Establezca las propiedades de ace mediante los [**métodos IADsAccessControlEntry:**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry)

    1.  Use [**IADsAccessControlEntry::p \_ trustee**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para establecer el administrador de confianza al que se aplica esta ACE. El administrador de confianza es un usuario, un grupo u otra entidad de seguridad. La aplicación debe usar el valor de la propiedad adecuada del objeto de usuario o grupo del administrador de confianza al que desea aplicar la ACE. El administrador de confianza se especifica como **BSTR** y puede tomar las formas siguientes:
        -   Cuenta de dominio (el nombre de inicio de sesión usado en una versión anterior de Windows NT) con el formato " dominio " donde " dominio " es el nombre del dominio de Windows NT que contiene el usuario y " cuenta de usuario " es la propiedad &lt; &gt; \\ <user account> &lt; &gt; &lt; &gt; **sAMAccountName** del usuario especificado. Por ejemplo: "fabrikam \\ jeffsmith".
        -   Entidad de seguridad conocida que representa identidades especiales definidas por el sistema de seguridad de Windows NT, como todos los usuarios, sistema local, entidad de seguridad propia, usuario autenticado, propietario del creador, y así sucesivamente. Los objetos que representan las entidades de seguridad conocidas se almacenan en el contenedor Well Known Security Principals debajo del contenedor Configuration. Por ejemplo, inicio de sesión anónimo.
        -   Grupo integrado que representa los grupos de usuarios integrados definidos por el Windows de seguridad NT. Tiene el formato "BUILTIN", donde " nombre de grupo \\ <group name> " es el nombre del grupo &lt; de &gt; usuarios integrado. Los objetos que representan los grupos integrados se almacenan en el contenedor builtin debajo del contenedor de dominio. Por ejemplo, "Administradores \\ INTEGRADOS".
        -   SID (formato de cadena) del usuario especificado, que es la **propiedad objectSID** del usuario especificado. Puede convertir a formato de cadena mediante la [**función ConvertSidToStringSid**](/windows/desktop/api/sddl/nf-sddl-convertsidtostringsida) en el cuadro de API para seguridad Win32. Por ejemplo: "S-1-5-32-548".
    2.  Use la [**propiedad IADsAccessControlEntry.AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para establecer la máscara que especifica el derecho de acceso. La [**\_ enumeración ADS RIGHTS \_ ENUM**](/windows/win32/api/iads/ne-iads-ads_rights_enum) especifica los derechos de acceso que se pueden establecer en un objeto de directorio.
    3.  Use la [**propiedad IADsAccessControlEntry.AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para especificar si se deben permitir o denegar los derechos de acceso establecidos **por AccessMask.** Para los derechos estándar, puede ser **ADS \_ ACETYPE \_ ACCESS ALLOWED \_ o** **ADS \_ ACETYPE ACCESS \_ \_ DENIED**. Para los derechos específicos del objeto (derechos que se aplican a una parte específica de un objeto o a un tipo específico de objeto), use **ADS \_ ACETYPE \_ ACCESS ALLOWED \_ \_ OBJECT** o **ADS \_ ACETYPE ACCESS DENIED \_ \_ \_ OBJECT**. La [**\_ enumeración ACETYPE \_ ENUM de ADS**](/windows/win32/api/iads/ne-iads-ads_acetype_enum) especifica los tipos de acceso que se pueden establecer en una ACE.
    4.  Use la [**propiedad IADsAccessControlEntry.AceFlags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para especificar si otros contenedores u objetos situados debajo del objeto especificado pueden heredar la ACE. La [**\_ enumeración ACEFLAG \_ ENUM de ADS**](/windows/win32/api/iads/ne-iads-ads_aceflag_enum) especifica las marcas de herencia que puede establecer en una ACE.
    5.  Use la [**propiedad IADsAccessControlEntry.Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para especificar si el derecho se aplica a una parte específica del objeto, a un tipo de objeto heredado o a ambos.
    6.  Si **Flags** se establece en **ADS FLAG OBJECT TYPE \_ \_ \_ \_ PRESENT**, establezca la propiedad [**IADsAccessControlEntry.ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) o especifique una cadena que contenga el GUID de la clase de objeto (para **ADS RIGHT \_ \_ DS CREATE \_ \_ CHILD** o **ADS RIGHT \_ \_ DS DELETE \_ \_ CHILD),** propiedad, conjunto de propiedades, escritura validada o derecho extendido al que se aplica la ACE. El GUID debe especificarse como una cadena del formulario generado por la [**función StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) en la biblioteca COM.
    7.  Si **Flags se** establece en **ADS FLAG \_ \_ INHERITED OBJECT TYPE \_ \_ \_ PRESENT**, establezca la propiedad [**IADsAccessControlEntry.InheritedObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) para especificar una cadena que contenga el GUID de la clase de objeto heredada a la que se aplica la ACE. El GUID debe especificarse como una cadena del formulario generado por la [**función StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) en la biblioteca COM.

6.  Use el **método QueryInterface** en [**el objeto IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) para obtener un [**puntero IDispatch.**](/windows/win32/api/oaidl/nn-oaidl-idispatch) El [**método IADsAccessControlList.AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) requiere un puntero de interfaz **IDispatch** a la ACE.
7.  Use [**IADsAccessControlList.AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) para agregar la nueva ACE a la DACL. Tenga en cuenta que el orden de las ACE dentro de la ACL puede afectar a la evaluación del acceso al objeto. El acceso correcto al objeto puede requerir que cree una nueva ACL, agregue las ACL de la ACL existente en el orden correcto a la nueva ACL y, a continuación, reemplace la ACL existente en el descriptor de seguridad por la nueva ACL. Para obtener más información, [vea Order of ACEs in a DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).
8.  Use la [**propiedad IADsSecurityDescriptor.DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) para escribir la DACL que contiene la nueva ACE en el descriptor de seguridad. Para obtener más información sobre las DACL, vea [NULL DACLs y Empty DACLs](null-dacls-and-empty-dacls.md).
9.  Use el [**método IADs.Put**](/windows/desktop/api/iads/nf-iads-iads-put) para escribir el descriptor de seguridad en la propiedad **nTSecurityDescriptor** del objeto en la caché de propiedades.
10. Use el [**método IADs.SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) para actualizar la propiedad en el objeto del directorio .

 

 
