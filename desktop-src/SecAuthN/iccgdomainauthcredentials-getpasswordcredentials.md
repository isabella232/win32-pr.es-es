---
description: Devuelve las credenciales para autenticar un contenedor que no está unido a un dominio con Active Directory.
title: Método ICcgDomainAuthCredentials::GetPasswordCredentials (ccgplugins.h)
ms.topic: reference
ms.date: 10/21/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- ICcgDomainAuthCredentials.GetPasswordCredentials
api_type:
- COM
api_location:
- ccgplugins.h
ms.openlocfilehash: abd70a109e491773b374ae32787760d265167baa
ms.sourcegitcommit: cb87082135319cbdc5df541e3071eebb83a58972
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/04/2021
ms.locfileid: "111387828"
---
# <a name="iccgdomainauthcredentialsgetpasswordcredentials-method"></a>ICcgDomainAuthCredentials::GetPasswordCredentials (método)

Devuelve las credenciales para autenticar un contenedor que no está unido a un dominio con Active Directory.

## <a name="syntax"></a>Sintaxis


```C++
HRESULT GetPasswordCredentials(
[in] LPCWSTR pluginInput, 
[out] LPWSTR* domainName, 
[out] LPWSTR* username, 
[out] LPWSTR* password);
);
```



## <a name="parameters"></a>Parámetros

<dl> <dt>

*pluginInput* \[ En\]
</dt> <dd>

Cadena de entrada pasada por el entorno de ejecución del contenedor. La implementación del cliente usa la cadena de entrada proporcionada para recuperar las credenciales de autenticación, normalmente de un proveedor de almacenamiento seguro, que se devuelven en los parámetros de salida. La cadena de entrada se proporciona al host Compute Services (HCS) en un archivo de especificación de credenciales. Para más información, vea la sección **Comentarios**.

</dd> </dl>

<dl> <dt>

*domainName* \[ out\]
</dt> <dd>

Nombre de dominio de las credenciales.

</dd> </dl>

<dl> <dt>

*nombre de usuario* \[ out\]
</dt> <dd>

Nombre de usuario de las credenciales.

</dd> </dl>

<dl> <dt>

*contraseña* \[ out\]
</dt> <dd>

Contraseña de las credenciales.

</dd> </dl>

## <a name="return-value"></a>Valor devuelto

El valor devuelto es **un HRESULT.** Un valor de S \_ OK indica que la llamada se ha realizado correctamente.

## <a name="remarks"></a>Comentarios

Se puede llamar a la API simultáneamente. Por lo tanto, el desarrollador debe asegurarse de que su implementación es segura para subprocesos. Además, el objeto COM se activará fuera de proceso y se debe registrar correctamente. 

El implementador debe agregar una clave en "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CCG\COMClasses" para su CLSID COM. El acceso de escritura a "CCG\COMClasses" está restringido a las cuentas SYSTEM y Administrator. 

A continuación se muestra un archivo de especificación de credenciales de ejemplo. Para obtener información sobre cómo proporcionar este archivo a Docker, [consulte Ejecución de un contenedor con una gMSA.](/virtualization/windowscontainers/manage-containers/gmsa-run-container)

```json
{
    "CmsPlugins": [
        "ActiveDirectory"
    ],
    "DomainJoinConfig": {
        "Sid": "S-1-5-21-3700119848-2853083131-2094573802",
        "MachineAccountName": "gmsa1",
        "Guid": "630a7dd3-2d3e-4471-ae91-1d9ea2556cd5",
        "DnsTreeName": "contoso.com",
        "DnsName": "contoso.com",
        "NetBiosName": "CONTOSO"
    },
    "ActiveDirectoryConfig": {
        "GroupManagedServiceAccounts": [
            {
                "Name": "gmsa1",
                "Scope": "contoso.com"
            },
            {
                "Name": "gmsa1",
                "Scope": "CONTOSO"
            }
        ],
        "HostAccountConfig": {
            "PortableCcgVersion": "1",
            "PluginGUID": "{CFCA0441-511D-4B2A-862E-20348A78760B}",
            "PluginInput": "contoso.com:gmsaccg:<password>"
        }
    }
}

```

## <a name="examples"></a>Ejemplos

En el ejemplo siguiente se muestra una implementación sencilla de **ICcgDomainAuthCredentials**. Tenga en cuenta que, para fines ilustrativos, este ejemplo obtiene las credenciales simplemente analizando la cadena de entrada. Una implementación real almacenaría las credenciales en un almacén de datos seguro y usaría la cadena de entrada para localizar la información de credenciales. Además, las implementaciones del método COM estándar se han omitido en este ejemplo por brevedad.


```C++
// UUID generated by the developer
[uuid("cfca0441-511d-4b2a-862e-20348a78760b")] 
class CCGStubPlugin : public RuntimeClass<RuntimeClassFlags<RuntimeClassType::ClassicCom>, ICcgDomainAuthCredentials >
{
   public:
    CCGStubPlugin() {}

    ~CCGStubPlugin() {}

    IFACEMETHODIMP GetPasswordCredentials(
        _In_ LPCWSTR pluginInput,
        _Outptr_ LPWSTR *domainName,
        _Outptr_ LPWSTR *username,
        _Outptr_ LPWSTR *password)
    {
        std::wstring domainParsed, userParsed, passwordParsed; 
        try
        {
            if(domainName == NULL || username == NULL || password == NULL)
            {
                return STG_E_INVALIDPARAMETER;
            }
            *domainName = NULL;
            *username = NULL;
            *password = NULL;
            wstring pluginInputString(pluginInput);
            if (count(pluginInputString.begin(), pluginInputString.end(), ':') < 2)
            {
                return CO_E_NOT_SUPPORTED;
            }
            // Extract creds of this format Domain:Username:Password
            size_t sep1 = pluginInputString.find(L":");
            size_t sep2 = pluginInputString.find(L":", sep1 + 1);
            domainParsed = pluginInputString.substr(0, sep1);
            userParsed = pluginInputString.substr(sep1 + 1, sep2 - sep1 - 1);
            passwordParsed = pluginInputString.substr(sep2 + 1);
        }
        catch (...)
        {
            return EVENT_E_INTERNALERROR;
        }

        auto userCo = wil::make_cotaskmem_string_nothrow(userParsed.c_str());
        auto passwordCo = wil::make_cotaskmem_string_nothrow(passwordParsed.c_str());
        auto domainCo = wil::make_cotaskmem_string_nothrow(domainParsed.c_str());
        if (userCo == nullptr || passwordCo == nullptr || domainCo == nullptr)
        {
            return STG_E_INSUFFICIENTMEMORY;
        }

        *domainName = domainCo.release();
        *username = userCo.release();
        *password = passwordCo.release();
        return S_OK;
    }
};
CoCreatableClass(CCGStubPlugin);

```



## <a name="requirements"></a>Requisitos




| Requisito | Valor |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| Servidor mínimo compatible | Windows Server, versión 2004                                    |
| Encabezado                   | ccgplugins.h   |
| IID                    | 6ecda518-2010-4437-8bc3-46e752b7b172          |



 

